<section class="w-full max-w-8xl mx-auto px-4 sm:px-6 md:px-8 py-6 md:py-10">
    <div class="flex flex-col md:flex-row justify-center md:justify-between items-center md:items-start gap-6">
        
        <!-- TITULO -->
        <div class="text-center md:text-left">
            <h1 class="text-[#1D8F93] text-4xl sm:text-5xl font-extrabold leading-tight">
                Pacientes
            </h1>
            <p class="text-black text-2xl sm:text-3xl font-light mt-2">
                Gestión de Pacientes
            </p>
        </div>

        <!-- BOTON -->
        <button (click)="modalRegistrarPaciente.set(true);" 
                class="bg-[#C3F2F3] text-[#545454] text-lg sm:text-xl md:text-2xl font-semibold tracking-wider rounded-xl shadow-lg 
                    px-8 sm:px-16 py-3 sm:py-4 hover:scale-105 transition-transform duration-300 flex items-center gap-4 sm:gap-6"
                title="Registrar nuevo paciente">
            <img src="assets/icons/agregar.svg" alt="Agregar Ingreso" class="w-10 h-10">
            <span>Nuevo Paciente</span>
        </button>

    </div>
</section>

<!-- CONTENEDOR DE PACIENTES VIGENTES -->
<section class="w-full min-h-screen bg-[#C3F2F3] p-4 sm:p-6 md:p-10 rounded-xl shadow-md">

    <!-- HEADER CON TÍTULO + BUSCADOR -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 md:gap-5 mb-6 md:mb-8">

        <h2 class="flex items-center gap-2 sm:gap-4 text-2xl sm:text-3xl md:text-4xl font-bold text-[#545454] tracking-wide">
            <img src="assets/icons/paciente.svg" alt="icon paciente" class="w-8 h-10 sm:w-10 sm:h-12" />
            Pacientes Vigentes
        </h2>

        <!-- Barra de búsqueda -->
        <div class="relative w-full mt-2 md:mt-0 md:w-[40rem]">
            <input 
                type="text"
                placeholder="Buscar Paciente.."
                class="w-full pl-10 sm:pl-12 pr-4 py-3 sm:py-3 rounded-xl border border-gray-300 shadow-sm text-sm sm:text-lg focus:outline-none focus:ring-2 focus:ring-teal-600"
                (input)="busqueda.set($event.target.value)" 
            />
            <img src="assets/icons/buscar.svg" class="w-5 h-5 sm:w-6 sm:h-6 absolute left-3 sm:left-4 top-2.5 sm:top-4 opacity-70" />
        </div>

    </div>


    <!-- GRID PARA LAS TARJETAS -->
    <div class="grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-2 xl:grid-cols-2 gap-6 sm:gap-8 mt-6 md:mt-8">

        @if (pacientesFiltrados().length === 0) {
            <p class="text-center text-2xl text-gray-600 col-span-full mt-10">
                No hay pacientes vigentes registrados.
            </p>
        }

        @for (paciente of pacientesFiltrados(); track paciente.id_paciente) {

            <!-- TARJETA DINAMICA -->
            <div class="bg-white border border-l-8 border-l-[#545454] rounded-2xl p-4 sm:p-6 shadow-md hover:shadow-lg transition">
                <!-- LAYOUT PRINCIPAL -->
                <div class="flex flex-row justify-between gap-4">

                    <!-- COLUMNA IZQUIERDA (INFO DEL PACIENTE) -->
                    <div class="flex flex-col gap-2 sm:gap-3 flex-1">
                        <h3 class="text-2xl sm:text-3xl font-bold text-[#105053]">
                            {{ paciente.nombre }} {{ paciente.apellido1 }} {{ paciente.apellido2 }}
                        </h3>

                        <p class="text-[#545454] text-base sm:text-lg">
                            {{ calcularEdad(paciente.fecha_nacimiento) }} años
                        </p>

                        <p class="text-[#545454] text-base sm:text-lg flex items-center gap-1 sm:gap-2">
                            <img src="assets/icons/correo.svg" class="w-5 h-5 sm:w-6 sm:h-6 opacity-80" />
                            {{ paciente.usuario.correo }}
                        </p>

                        <p class="text-[#545454] text-base sm:text-lg flex items-center gap-1 sm:gap-2">
                            <img src="assets/icons/telefono.svg" class="w-5 h-5 sm:w-6 sm:h-6 opacity-80" />
                            {{ paciente.telefono | telefono }}
                        </p>
                    </div>

                    <!-- COLUMNA DERECHA (BOTONES) -->
                    <div class="flex flex-col justify-between items-center md:items-end gap-2 sm:gap-4 w-auto">
                        <div title="Ir a expediente" 
                            [routerLink]="['/doc/pacientes/expediente', paciente.id_paciente]"
                            class="w-14 h-14 md:w-16 md:h-16 rounded-xl bg-[#545454] flex items-center justify-center shadow hover:bg-[#DDE0EB] transition">
                            <img src="assets/icons/expediente.svg" alt="Expediente" class="w-10 h-10 md:w-12 md:h-12"/>
                        </div>
                        <div title="Dar de baja Paciente" (click)="abrirModalEliminar(paciente)"
                            class="w-14 h-14 md:w-16 md:h-16 rounded-xl bg-[#BC0E0E] flex items-center justify-center shadow hover:bg-[#F8636B] transition">
                            <img src="assets/icons/baja-paciente.svg" alt="Baja Paciente" class="w-10 h-10 md:w-12 md:h-12"/>
                        </div>
                    </div>


                </div>
            </div>

        }

    </div>

</section>


@if(modalRegistrarPaciente()) {
    <app-modal-registro-paciente
        (cerrar)="cerrarModal()"
        (registrar)="registrarNuevoPaciente($event)"
    >
    </app-modal-registro-paciente>
}

@if (modalEliminar()) {
    <app-modal-confirmar-logdelete
        [visible]="modalEliminar()"
        (confirm)="confirmarEliminacion()"
        (cancel)="cancelarEliminacion()"
        [titulo]="'Baja de Paciente'"
        [texto]="'¿Está seguro de dar de baja este paciente?'"
    >
    </app-modal-confirmar-logdelete>
}
