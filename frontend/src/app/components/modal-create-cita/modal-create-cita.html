<div class="fixed inset-0 bg-black/70 flex justify-center items-center z-50">

    <div class="relative bg-white p-6 rounded-xl max-h-[90vh] overflow-y-auto w-[460px]">
        <div class="grid gap-0"> 
            <h2 class="text-3xl font-bold mt-2 mb-6 text-[#105053]">
                Agendar una Cita
            </h2>

            <div>
                <label class="block text-base font-medium text-[#545454] mb-1">
                    Servicio aplicado
                </label>

                <mat-form-field appearance="outline" class="w-full">
                    <mat-select placeholder="Seleccione servicio" required [(ngModel)]="id_servicio">
                    
                    @for(serv of tiposServicio; track serv.id_servicio) {
                        <mat-option [value]="serv.id_servicio">
                        {{ serv.nombre }}
                        </mat-option>
                    }

                    </mat-select>
                </mat-form-field>
            </div>

            <!-- BUSCADOR DE PACIENTE -->
            <div class="relative mb-6">
                <label class="block text-base font-medium text-[#545454] mb-1">
                    Paciente
                </label>

                <div class="relative">
                    <input
                        type="text"
                        class="w-full border border-teal-600 bg-zinc-300/30 rounded-lg px-4 py-3 pl-10 shadow-sm focus:ring-2 focus:ring-[#545454] focus:outline-none"
                        placeholder="Buscar paciente..."
                        [(ngModel)]="busquedaPaciente"
                        (input)="buscarPaciente()"
                    />

                    <!-- Icono lupa -->
                    <img src="assets/icons/buscar.svg"
                        class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 opacity-60">
                </div>

                <!-- LISTA DE RESULTADOS -->
                @if (mostrarLista && pacientesFiltrados.length > 0) {
                    <div
                        class="absolute z-20 bg-white border rounded-lg w-full mt-1 max-h-56 overflow-auto shadow-lg"
                    >
                        @for (p of pacientesFiltrados; track p.id_paciente) {
                            <div
                                (click)="seleccionarPaciente(p)"
                                class="px-4 py-2 hover:bg-[#C3F2F3] cursor-pointer text-base"
                            >
                                {{ p.nombre }} {{ p.apellido1 }} {{ p.apellido2 || '' }}
                            </div>
                        }
                    </div>
                }
            </div>

            <!-- Fecha -->
            <div class="mb-6">
                <label class="block text-base font-medium text-[#545454] mb-1">Fecha</label>
                <input #fechaInput type="text" placeholder="Selecciona la fecha" required [(ngModel)]="fecha"
                    class="w-full h-12 border border-teal-600 bg-zinc-300/30 rounded-lg p-2 pl-3 focus:ring-2 focus:ring-[#545454] focus:outline-none" />
            </div>

            <div class="mb-6">
                <label class="block text-base font-medium text-[#545454] mb-1">Hora de la Cita</label>

                <input
                    matInput
                    [ngxTimepicker]="tpInicio"
                    [(ngModel)]="hora_inicio"
                    placeholder="00:00"
                    readonly
                    class="w-full mt-1 border border-teal-600 bg-zinc-300/30 rounded-md p-3"
                />
                <ngx-material-timepicker #tpInicio></ngx-material-timepicker>
            </div>

            <!-- frecuencia de la cita -->
            <div>
                <label class="block text-base font-medium text-[#545454] mb-1">
                    Frecuencia de Servicio
                </label>

                <mat-form-field appearance="outline" class="w-full">
                    <mat-select placeholder="Seleccione frecuencia" required [(ngModel)]="frecuencia">
                        @for(f of frecuencias; track f.id) {
                        <mat-option [value]="f.id">
                            {{ f.nombre }}
                        </mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            </div>

            <!-- Notas -->
            <div class="mb-6">
                <label class="block text-base font-medium text-[#545454] mb-1">Notas</label>
                <textarea placeholder="Notas sobre la cita (Se breve)" rows="3" [(ngModel)]="notas"
                            class="w-full border border-[#1D8F93] bg-zinc-300/30 rounded-lg p-3 focus:ring-2 focus:ring-[#105053] focus:outline-none resize-none"></textarea>
            </div>

            <div class="flex justify-end gap-4 mt-6">
                <button
                    class="px-6 py-2 bg-neutral-600 rounded-lg inline-flex justify-center items-center cursor-pointer hover:bg-[#9C9898]"
                    (click)="cancelar()"
                >
                    <span class="text-center text-white text-lg font-semibold tracking-wider">Cancelar</span>
                </button>

                <button
                    class="px-6 py-2 bg-[#1D8E92] rounded-lg inline-flex justify-center items-center cursor-pointer hover:bg-[#105053]"
                    (click)="crearCita()"
                >
                    <span class="text-center text-white text-lg font-semibold tracking-wider">Agendar</span>
                </button>
            </div>

        </div>
    </div>
</div>
