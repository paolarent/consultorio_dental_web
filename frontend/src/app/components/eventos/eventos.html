<section class="relative rounded-2xl py-8 px-10 w-full max-w-8xl bg-white mx-auto">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-10 items-start">

        <!-- Columna izquierda (1/4) -->
        <div class="md:col-span-1 flex flex-col h-full">

            <!-- Parte superior: títulos y botón Agendar Cita -->
            <div class="flex flex-col items-start space-y-6">
                <h1 class="text-[#1D8F93] text-5xl font-extrabold leading-tight">
                    Mi Agenda
                </h1>

                <p class="text-black text-3xl font-light">
                    Eventos
                </p>

                <button (click)="abrirModalCrearEvento()"
                class="bg-[#C3F2F3] text-[#545454] text-lg md:text-xl font-semibold tracking-wider rounded-xl shadow-md px-16 py-4 
                hover:scale-105 transition-transform duration-300"
                >
                    Agendar Evento
                </button>
            </div>

            <!-- Parte inferior: botones Ir a Eventos y engranaje -->
            <div class="mt-72 flex items-center w-full gap-16">
            
                <button
                    (click)="irACitas()"
                    class="flex items-center gap-2 bg-[#1D8E92] text-white text-lg md:text-xl font-bold tracking-wider px-6 py-3 rounded-xl shadow-lg hover:scale-105 transition"
                >
                    <img src="assets/icons/ic-citas.svg" alt="Ir a Citas" class="w-8 h-8">
                    Ir a Citas
                </button>

                <!-- Engranaje -->
                <button (click)="abrirModalHorario()"
                    class="bg-gray-200 p-2 rounded-full shadow-lg hover:scale-105 transition-transform duration-300 cursor-pointer">
                    <img src="assets/icons/settings.svg" alt="Configuración" title="Configuración" class="w-10 h-10"/>
                </button>

            </div>

        </div>


        <!-- Columna derecha (3/4) - Calendario -->
        <div class="md:col-span-3 rounded-2xl">
            <app-calendario></app-calendario>
        </div>

    </div>
</section>

<section>
    <div class="bg-[#C3F2F3] rounded-lg p-6 max-h-[500px] flex flex-col">

        <!-- BUSCADOR + FILTRO -->
        <div class="px-4 mb-4 mt-6 w-full flex items-center gap-6 flex-shrink-0">

            <!-- BUSCADOR -->
            <div class="relative flex-1 max-w-7xl -translate-y-3">
                <input
                    type="text"
                    placeholder="Buscar por título o notas..."
                    (input)="actualizarBusqueda($event.target.value)"
                    class="w-full pl-16 pr-4 rounded-xl border border-gray-300 shadow-sm text-base xl:text-lg
                        focus:outline-none focus:ring-2 focus:ring-teal-600 h-12"
                />
                <img
                    src="assets/icons/buscar.svg"
                    class="w-6 h-6 xl:w-6 xl:h-6 absolute left-4 top-1/2 -translate-y-1/2 opacity-70"
                />
            </div>

            <!-- FILTRO -->
            <mat-form-field appearance="outline" class="w-80 custom-select">
                <mat-select [value]="filtro()" (selectionChange)="actualizarFiltro($event.value)">
                    <mat-option value="todos">Todos</mat-option>

                    @for (t of tiposEvento; track t.id_tipo_evento) {
                        <mat-option [value]="t.nombre.toLowerCase()">
                            {{ t.nombre }}
                        </mat-option>
                    }
                </mat-select>
            </mat-form-field>
        </div>

        <!-- CARDS CON LOS EVENTOS -->
        <div class="flex-1 overflow-y-auto">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                @for (ev of eventosFiltrados(); track ev.id_evento) {
                    <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 p-5 w-full">
                        
                        <!-- Header -->
                        <div class="flex flex-col sm:flex-row sm:items-start justify-between gap-3 sm:gap-4">
                        
                        <!-- Título -->
                        <h3 class="text-xl sm:text-2xl font-extrabold text-black flex-1 min-w-0">
                            {{ ev.titulo }}
                        </h3>
                        
                        <!-- Badge + Botón (se apilan en móvil, en línea en desktop) -->
                        <div class="flex items-center gap-8 flex-shrink-0">
                            <!-- Badge de tipo -->
                            <div
                                class="rounded-full px-3 sm:px-4 py-2 sm:py-3 flex items-center justify-center"
                                [ngClass]="{
                                    'bg-green-200 text-green-950': ev.tipo_evento.nombre === 'Curso',
                                    'bg-purple-100 text-purple-700': ev.tipo_evento.nombre === 'Congreso',
                                    'bg-amber-100 text-yellow-800': ev.tipo_evento.nombre === 'Vacaciones',
                                    'bg-cyan-100 text-teal-900': ev.tipo_evento.nombre === 'Conferencia',
                                    'bg-red-200 text-red-700': ev.tipo_evento.nombre === 'Capacitación',
                                    'bg-pink-200 text-pink-900': ev.tipo_evento.nombre === 'Personal',
                                    'bg-blue-200 text-blue-950 ': ev.tipo_evento.nombre === 'Otro'
                                }"
                                >
                                    <span class="text-sm sm:text-base font-bold whitespace-nowrap">
                                        {{ ev.tipo_evento.nombre }}
                                    </span>
                            </div>


                            <!-- Botón de acción -->
                            <button (click)="abrirModalEditarEvento(ev)" class="bg-[#25BEC4] hover:bg-[#115153] rounded-xl shadow-md p-2.5 sm:p-3 transition-colors duration-300">
                                <img src="assets/icons/edit.svg" alt="Editar" class="w-7 h-7" />
                            </button>

                            <button (click)="abrirModalEliminar(ev.id_evento)" class="bg-[#BC0E0E] hover:bg-[#600606] rounded-xl shadow-md p-2 sm:p-3 transition-colors duration-300">
                                <img src="assets/icons/cancelar.svg" alt="Editar" class="w-7 h-7" />
                            </button>
                        </div>
                        
                        </div>

                        <!-- Info: Fecha y Hora -->
                        <div class="space-y-2.5 sm:space-y-3 mb-4">
                        
                        <!-- Fecha -->
                        <div class="flex items-center gap-2.5 sm:gap-3">
                            <svg class="w-5 h-5 sm:w-7 sm:h-7 text-neutral-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke-width="2"/>
                            <line x1="16" y1="2" x2="16" y2="6" stroke-width="2"/>
                            <line x1="8" y1="2" x2="8" y2="6" stroke-width="2"/>
                            <line x1="3" y1="10" x2="21" y2="10" stroke-width="2"/>
                            </svg>
                            <span class="text-neutral-600 text-sm sm:text-base">
                            {{ toLocalDate(ev.fecha_inicio) | date:'dd/MMM/yyyy':'':'es' }} - {{ toLocalDate(ev.fecha_fin) | date:'dd/MMM/yyyy':'':'es' }}
                            </span>
                        </div>

                        <!-- Hora -->
                        <div class="flex items-center gap-2.5 sm:gap-3">
                            <svg class="w-5 h-5 sm:w-7 sm:h-7 text-neutral-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10" stroke-width="2"/>
                            <polyline points="12 6 12 12 16 14" stroke-width="2"/>
                            </svg>
                            
                            @if (ev.evento_todo_el_dia === 'si') {
                            <span class="text-neutral-600 text-sm sm:text-base">Todo el día</span>
                            } @else {
                            <span class="text-neutral-600 text-sm sm:text-base">
                                {{ ev.hora_inicio }} - {{ ev.hora_fin }}
                            </span>
                            }
                        </div>
                        
                        </div>

                        <!-- Descripción / Notas -->
                        <p class="text-neutral-600 text-sm sm:text-base leading-relaxed">
                            {{ ev.notas || 'Sin Notas' }}
                        </p>

                    </div>
                    }

            </div>
        </div>

    </div>
</section>

<!-- MODAL PARA EDITAR HORARIO -->
@if (mostrarModalHorario()) {
    <app-modal-config-horario 
    (cerrar)="cerrarModal()">
    </app-modal-config-horario>
}

<!-- Modal -->
@if (modalEvento()) {
    <app-modal-evento
        [modoEdicion]="modoEdicion()"
        [idEventoEditar]="idEventoEditar"
        (cerrar)="cerrarModalEvento()"
        (guardar)="guardarEvento($event)"
    ></app-modal-evento>
}

@if (modalEliminarLD()) {
    <app-modal-confirmar-logdelete
        [visible]="modalEliminarLD()"
        (confirm)="confirmarEliminacion()"
        (cancel)="cerrarModalSD()"
        [titulo]="'Eliminar Evento'"
        [texto]="'¿Está seguro de eliminar este evento?'">
    </app-modal-confirmar-logdelete>
} 
