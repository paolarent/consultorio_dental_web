<section class="relative rounded-2xl py-4 px-4 sm:px-6 md:py-8 md:px-10 w-full max-w-8xl bg-white mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 md:gap-10 items-start">

        <!-- Columna izquierda -->
        <div class="lg:col-span-1 flex flex-col justify-between h-full w-full space-y-6">

            <!-- Parte superior: títulos y botón principal -->
            <div class="flex flex-col space-y-4 sm:space-y-6">
                <h1 class="text-[#1D8F93] text-3xl md:text-4xl xl:text-5xl font-extrabold leading-tight">
                    Mi Agenda
                </h1>

                <p class="text-black text-lg md:text-xl xl:text-2xl font-light">
                    Citas
                </p>

                <button (click)="abrirModalCrearCita()"
                    class="bg-[#C3F2F3] text-[#545454] text-lg md:text-xl xl:text-2xl 
                        font-semibold tracking-wider rounded-lg shadow-md 
                        px-10 sm:px-14 md:px-16 py-2.5 sm:py-3 
                        hover:scale-105 transition-transform duration-300
                        w-full sm:w-auto text-center">
                    Agendar Cita
                </button>
            </div>

            <!-- Parte inferior: botones secundarios -->
            <div class="flex flex-col sm:flex-row items-center sm:items-center 
                        gap-4 sm:gap-16 mt-4 w-full">

                <!-- Botón Ir a Eventos -->
                <button
                    (click)="irAEventos()"
                    class="flex items-center gap-4 lg:gap-2 bg-[#1D8E92] text-white text-base md:text-lg font-bold 
                        tracking-wider px-4 sm:px-6 py-2 sm:py-3 rounded-xl shadow-lg 
                        hover:scale-105 transition w-full sm:w-auto justify-center">
                    <img src="assets/icons/ic-eventos.svg" alt="Ir a Eventos" class="w-4 h-4 sm:w-6 sm:h-6">
                    Ir a Eventos
                </button>

                <!-- Botón del engranaje -->
                <button 
                    (click)="abrirModalHorario()"
                    class="bg-gray-200 rounded-full shadow-lg hover:scale-105 
                        transition-transform duration-300 cursor-pointer
                        flex items-center justify-center
                        w-12 h-12 sm:w-14 sm:h-14 flex-shrink-0">
                    <img src="assets/icons/settings.svg" alt="Configuración" title="Configuración"
                        class="w-6 h-6 sm:w-8 sm:h-8" />
                </button>

            </div>

        </div>

        <!-- Columna derecha (Calendario) -->
        <div class="lg:col-span-3 rounded-2xl mt-6 lg:mt-0 w-full min-h-[400px]">
            <app-calendario class="block w-full h-full"></app-calendario>
        </div>

    </div>

</section>

<section>
    <div class="bg-[#C3F2F3] rounded-lg p-6 max-h-[500px] flex flex-col">

        <!-- BUSCADOR + FILTRO -->
        <div class="px-4 mb-4 mt-6 w-full 
                    flex flex-col lg:flex-row 
                    items-stretch lg:items-center 
                    gap-4 lg:gap-6 flex-shrink-0">

            <!-- BUSCADOR -->
            <div class="relative flex-1 max-w-full lg:max-w-7xl lg:-translate-y-3">
                <input
                type="text"
                placeholder="Buscar..."
                (input)="actualizarBusqueda($event)"
                class="w-full pl-16 pr-4 rounded-xl border border-gray-300 shadow-sm text-base xl:text-lg
                    focus:outline-none focus:ring-2 focus:ring-teal-600 h-12"
                />
                <img
                src="assets/icons/buscar.svg"
                class="w-6 h-6 xl:w-6 xl:h-6 absolute left-4 top-1/2 -translate-y-1/2 opacity-70"
                />
            </div>

            <!-- FILTRO -->
            <mat-form-field appearance="outline" 
                class="w-full lg:w-80 custom-select">
                <mat-select placeholder="Filtrar" [value]="filtroEstado()" (selectionChange)="cambiarFiltro($event.value)">
                    <mat-option value="todas">Todas</mat-option>
                    <mat-option value="pendiente">Pendientes</mat-option>
                    <mat-option value="programada">Programadas</mat-option>
                    <mat-option value="reprogramada">Reprogramadas</mat-option>
                    <mat-option value="completada">Completadas</mat-option>
                    <mat-option value="cancelada">Canceladas</mat-option>
                </mat-select>
            </mat-form-field>

        </div>

        <!-- LISTA DE CITAS -->
        <div class="flex-1 overflow-y-auto">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                @for(cita of citasFiltradas(); track cita.id_cita){
                <div class="bg-white rounded-xl shadow-md p-5 border border-gray-200 hover:shadow-lg transition relative min-h-[180px]">

                    <!-- CONTENIDO PRINCIPAL -->
                    <div class="pr-0 md:pr-40">

                        <!-- NOMBRE -->
                        <div class="flex items-center gap-4 mb-1">
                            <h2 class="text-2xl font-extrabold text-black mb-1">
                                {{ cita.paciente }}
                            </h2>
                            
                            <!-- BADGE ESTADO -->
                            <span class="px-3 py-1 rounded-xl text-md font-bold text-center whitespace-nowrap"
                                [ngClass]="{
                                    'bg-yellow-100 text-yellow-700': cita.status === 'pendiente',
                                    'bg-cyan-100 text-teal-900': cita.status === 'programada',
                                    'bg-purple-100 text-purple-700': cita.status === 'reprogramada',
                                    'bg-green-100 text-green-700': cita.status === 'completada',
                                    'bg-red-100 text-red-700'  : cita.status === 'cancelada'
                                }">
                                {{ cita.status }}
                            </span>
                        </div>

                        <!-- SERVICIO -->
                        <p class="text-neutral-600 text-md font-normal mb-4">
                            {{ cita.servicio ?? 'Sin especificar' }}
                        </p>

                        <!-- FECHA -->
                        <div class="flex items-center gap-2 text-neutral-600 mb-2">
                            <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke-width="2"/>
                                <line x1="16" y1="2" x2="16" y2="6" stroke-width="2"/>
                                <line x1="8" y1="2" x2="8" y2="6" stroke-width="2"/>
                                <line x1="3" y1="10" x2="21" y2="10" stroke-width="2"/>
                            </svg>
                            <p class="text-base font-normal">
                                {{ cita.fecha | date:'EEEE, d \'de\' MMMM \'de\' yyyy':'':'es' }}
                            </p>
                        </div>

                        <!-- HORA -->
                        <div class="flex items-center gap-2 text-neutral-600 mb-4">
                            <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" stroke-width="2"/>
                                <polyline points="12 6 12 12 16 14" stroke-width="2"/>
                            </svg>
                            <p class="text-base font-normal">
                                {{ cita.hora_inicio | date:'hh:mm a' }}
                            </p>
                        </div>

                        <!-- NOTAS -->
                        @if(cita.notas){
                            <p class="text-neutral-600 text-base font-normal">
                                {{ cita.notas }}
                            </p>
                        }

                    </div>

                    <!-- BOTONES -->
                    <div class="flex flex-col gap-3 mt-4 md:absolute md:bottom-5 md:right-5">

                        <!-- PENDIENTE -->
                        @if(cita.status === 'pendiente') {
                            <button (click)="abrirModalAUS(cita, 'programar')"
                                class="w-32 h-9 bg-teal-900 rounded-lg shadow-md text-white text-base font-bold hover:bg-teal-800 transition">
                                Programar
                            </button>
                            <button (click)="abrirModalAUS(cita, 'cancelar')"
                                class="w-32 h-9 bg-red-700 rounded-lg shadow-md text-white text-base font-bold hover:bg-red-800 transition">
                                Cancelar
                            </button>
                            <button (click)="abrirModalReprogramar(cita)"
                                class="w-32 h-9 bg-purple-950 rounded-lg shadow-md text-white text-base font-bold hover:bg-indigo-900 transition">
                                Reprogramar
                            </button>
                        }

                        <!-- PROGRAMADA -->
                        @if(cita.status === 'programada') {
                            <button (click)="abrirModalAUS(cita, 'completar')"
                                class="w-32 h-9 bg-green-800 rounded-lg shadow-md text-white text-base font-bold hover:bg-green-900 transition">
                                Completada
                            </button>
                            <button (click)="abrirModalAUS(cita, 'cancelar')"
                                class="w-32 h-9 bg-red-700 rounded-lg shadow-md text-white text-base font-bold hover:bg-red-800 transition">
                                Cancelar
                            </button>
                            <button (click)="abrirModalReprogramar(cita)"
                                class="w-32 h-9 bg-purple-950 rounded-lg shadow-md text-white text-base font-bold hover:bg-indigo-900 transition">
                                Reprogramar
                            </button>
                        }

                        <!-- REPROGRAMADA -->
                        @if(cita.status === 'reprogramada') {
                            <button (click)="abrirModalAUS(cita, 'programar')"
                                class="w-32 h-9 bg-teal-900 rounded-lg shadow-md text-white text-base font-bold hover:bg-teal-800 transition">
                                Programar
                            </button>
                            <button (click)="abrirModalAUS(cita, 'cancelar')"
                                class="w-32 h-9 bg-red-700 rounded-lg shadow-md text-white text-base font-bold hover:bg-red-800 transition">
                                Cancelar
                            </button>
                        }

                    </div>

                </div>
                }

            </div>
        </div>

    </div>
</section>

<!-- MODAL PARA EDITAR HORARIO -->
@if (modalHorario()) {
    <app-modal-config-horario (cerrar)="cerrarModalHorario()"></app-modal-config-horario>
}

@if (modalCrearCita()) {
    <app-modal-create-cita
        (crear)="onCitaCreada($event)"
        (cerrar)="cerrarModalCrearCita()">
    </app-modal-create-cita>
}

@if (modalVisible()) {
    <app-modal-confirmar-logdelete
    [titulo]="modalTitulo()"
    [texto]="modalTexto()"
    [tipo]="modalTipo()"
    (confirm)="confirmarModal()"
    (cancel)="cancelarModal()"
    >
    </app-modal-confirmar-logdelete>
}

@if(modalReprogramar()) {
    <app-modal-reprog-cita
        [cita]="citaParaReprogramar"
        (cerrar)="cerrarModalReprogramar()"
        [mostrarPaciente]="true"
        [mostrarServicio]="true"
        (reprogramar)="reprogramarCita($event)"
        >
    </app-modal-reprog-cita>
}
